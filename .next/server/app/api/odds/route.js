"use strict";(()=>{var e={};e.id=521,e.ids=[521],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8792:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>u,staticGenerationAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{GET:()=>d});var s=a(9303),o=a(8716),i=a(670),n=a(7070),l=a(2468);async function d(e){try{let t;if(!process.env.THE_ODDS_API_KEY)return n.NextResponse.json({error:"The Odds API key not configured",message:"Please add THE_ODDS_API_KEY to your .env file"},{status:503});let a=e.nextUrl.searchParams,r=a.get("sport")||"all",s="true"===a.get("refresh");s&&l.q1.clearCache();let o=new l.q1;switch(r.toLowerCase()){case"nfl":let i=await o.getNFLSpreads();t={sport:"NFL",games:l.q1.formatOddsForDisplay(i),raw:i};break;case"ncaaf":let d=await o.getNCAASpreads();t={sport:"NCAAF",games:l.q1.formatOddsForDisplay(d),raw:d};break;default:let c=await o.getAllSpreads();t={nfl:{sport:"NFL",games:l.q1.formatOddsForDisplay(c.nfl),count:c.nfl.length},ncaaf:{sport:"NCAAF",games:l.q1.formatOddsForDisplay(c.ncaaf),count:c.ncaaf.length},timestamp:new Date().toISOString()}}return n.NextResponse.json({success:!0,data:t,cached:!s,timestamp:new Date().toISOString()})}catch(e){if(console.error("Error fetching odds:",e),e instanceof Error){if(e.message.includes("Invalid API key"))return n.NextResponse.json({error:"Invalid API key",message:"Please check your THE_ODDS_API_KEY"},{status:401});if(e.message.includes("Rate limit"))return n.NextResponse.json({error:"Rate limit exceeded",message:"Too many requests. Please try again later."},{status:429})}return n.NextResponse.json({error:"Failed to fetch odds",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/odds/route",pathname:"/api/odds",filename:"route",bundlePath:"app/api/odds/route"},resolvedPagePath:"/Users/jb/Development/office_football_pool/src/app/api/odds/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:u}=c,h="/api/odds/route";function g(){return(0,i.patchFetch)({serverHooks:u,staticGenerationAsyncStorage:m})}},2468:(e,t,a)=>{a.d(t,{Rr:()=>f,q1:()=>g});var r=a(1067);let s=process.env.THE_ODDS_API_KEY,o="https://api.the-odds-api.com/v4",i={NFL:"americanfootball_nfl",NCAAF:"americanfootball_ncaaf"},n={SPREADS:"spreads"},l={US:"us"};r.Ry({key:r.Z_(),title:r.Z_(),last_update:r.Z_()});let d=r.Ry({name:r.Z_(),price:r.Rx(),point:r.Rx().optional()}),c=r.Ry({key:r.Z_(),last_update:r.Z_(),outcomes:r.IX(d)}),p=r.Ry({id:r.Z_(),sport_key:r.Z_(),sport_title:r.Z_(),commence_time:r.Z_(),home_team:r.Z_(),away_team:r.Z_(),bookmakers:r.IX(r.Ry({key:r.Z_(),title:r.Z_(),last_update:r.Z_(),markets:r.IX(c)}))}),m=r.Ry({key:r.Z_(),group:r.Z_(),title:r.Z_(),description:r.Z_(),active:r.O7(),has_outrights:r.O7()}),u=new Map,h=0;class g{constructor(e){if(this.apiKey=e||s||"",!this.apiKey)throw Error("THE_ODDS_API_KEY is not configured")}async enforceRateLimit(){let e=Date.now()-h;e<1e3&&await new Promise(t=>setTimeout(t,1e3-e)),h=Date.now()}getCached(e){let t=u.get(e);return t&&Date.now()-t.timestamp<3e5?(console.log(`Cache hit for ${e}`),t.data):null}setCache(e,t){u.set(e,{data:t,timestamp:Date.now()})}async getSports(){let e="sports",t=this.getCached(e);if(t)return t;await this.enforceRateLimit();let a=`${o}/sports?apiKey=${this.apiKey}`,s=await fetch(a);if(!s.ok)throw Error(`Failed to fetch sports: ${s.statusText}`);let i=await s.json(),n=r.IX(m).parse(i);return this.setCache(e,n),n}async getOdds(e,t=[n.SPREADS],a=l.US,s="american"){let i=`odds-${e}-${t.join(",")}-${a}`,d=this.getCached(i);if(d)return d;await this.enforceRateLimit();let c=new URLSearchParams({apiKey:this.apiKey,regions:a,markets:t.join(","),oddsFormat:s}),m=`${o}/sports/${e}/odds?${c}`;console.log(`Fetching odds from: ${m.replace(this.apiKey,"REDACTED")}`);let u=await fetch(m);if(!u.ok){if(401===u.status)throw Error("Invalid API key");if(429===u.status)throw Error("Rate limit exceeded");throw Error(`Failed to fetch odds: ${u.statusText}`)}let h=u.headers.get("x-requests-remaining"),g=u.headers.get("x-requests-used");console.log(`API Usage - Used: ${g}, Remaining: ${h}`),h&&100>parseInt(h)&&console.warn(`⚠️ Low API requests remaining: ${h}`);let f=await u.json(),_=r.IX(p).parse(f),y=new Date,w=_.filter(e=>new Date(e.commence_time)>y);return console.log(`Filtered ${_.length-w.length} live games out of ${_.length} total games`),this.setCache(i,w),w}async getNFLSpreads(){return this.getOdds(i.NFL,[n.SPREADS])}async getNCAASpreads(){return this.getOdds(i.NCAAF,[n.SPREADS])}async getAllSpreads(){let[e,t]=await Promise.all([this.getNFLSpreads(),this.getNCAASpreads()]);return{nfl:e,ncaaf:t}}static getBestSpread(e){let t=null,a=null,r=null,s=null;for(let o of e.bookmakers){let i=o.markets.find(e=>e.key===n.SPREADS);if(i){let n=i.outcomes.find(t=>t.name===e.home_team),l=i.outcomes.find(t=>t.name===e.away_team);if(n?.point!==void 0&&l?.point!==void 0){t=n.point,a=l.point,r=o.title,s=o.last_update;break}}}return{homeTeam:e.home_team,awayTeam:e.away_team,homeSpread:t,awaySpread:a,bookmaker:r,lastUpdate:s}}static formatOddsForDisplay(e){return e.map(e=>{let t=this.getBestSpread(e);return{gameId:e.id,homeTeam:t.homeTeam,awayTeam:t.awayTeam,homeSpread:t.homeSpread,awaySpread:t.awaySpread,gameTime:e.commence_time,bookmaker:t.bookmaker}})}static clearCache(){u.clear(),console.log("Odds API cache cleared")}}let f=()=>{if(!process.env.THE_ODDS_API_KEY)throw Error("THE_ODDS_API_KEY is not configured. Please add it to your .env file.");return new g}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,972,67],()=>a(8792));module.exports=r})();